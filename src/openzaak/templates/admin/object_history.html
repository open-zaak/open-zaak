{% extends "admin/object_history.html" %}
{% comment %} SPDX-License-Identifier: EUPL-1.2 {% endcomment %}
{% comment %} Copyright (C) 2019 - 2020 Dimpact {% endcomment %}
{% load i18n admin_urls %}
{% load static %}



{% block content %}
    {% if object.audittrail %}
        <div id="content-main-audittrail">
            <div class="module">
                <table id="change-history">
                    <thead>
                    <tr>
                        <th scope="col">{% trans 'Aanmaakdatum' %}</th>
                        <th scope="col">{% trans 'UUID' %}</th>
                        <th scope="col">{% trans 'Actie' %}</th>
                        <th scope="col">{% trans 'Resultaat' %}</th>
                        <th scope="col">{% trans 'Gebruiker' %}</th>
                        <th scope="col">{% trans 'Applicatie' %}</th>
                        <th scope="col">{% trans 'Object' %}</th>
                        <th scope="col">{% trans 'Toelichting' %}</th>
                        <th scope="col">{% trans 'Wijzigingen' %}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for audit, changes in object.audittrail %}
                        <tr>
                            <th scope="row">{{ audit.aanmaakdatum }}</th>
                            <td>{{ audit.uuid }}</td>
                            <td>{{ audit.actie_weergave }}</td>
                            <td>{{ audit.resultaat }}</td>
                            <td>{{ audit.gebruikers_weergave }}</td>
                            <td>{{ audit.applicatie_weergave }}</td>
                            <td>{{ audit.resource_url }}</td>
                            <td>{{ audit.toelichting }}</td>
                            <td>
                                <button class="button"
                                        onclick="toggleTable('detail-{{ forloop.counter }}')">{% trans 'Toon wijzigingen' %}</button>
                                <script>
                                    function toggleTable(id) {
                                        const tables = document.getElementsByClassName("audit-table");
                                        for (let table of tables) {
                                            table.style.display = "none";
                                        };

                                        const selected_table = document.getElementById(id);
                                        selected_table.style.display = "block"

                                        const title = document.getElementById("audit-table-title");
                                        title.style.display = "block"
                                    }
                                </script>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <h5 id="audit-table-title" style="display: none">Gewijzigde velden</h5>

                {% for audit, changes in object.audittrail %}
                    <table id='detail-{{ forloop.counter }}' style="display: none" class="audit-table">
                        <thead>
                        <tr>
                            <th scope="col">{% trans 'veld' %}</th>
                            <th scope="col">{% trans 'oud' %}</th>
                            <th scope="col">{% trans 'nieuw' %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for change in changes %}
                            {% for field, diff in change.1.items %}
                                <tr>
                                    <th scope="row">{{ field }}</th>
                                    {% if change.0 == 'add' %}
                                        <td>-</td>
                                        <td>{{ diff }}</td>
                                    {% elif change.0 == 'change' %}
                                        <td>{{ diff.0 }}</td>
                                        <td>{{ diff.1 }}</td>
                                    {% elif change.0 == 'remove' %}
                                        <td>{{ diff }}</td>
                                        <td>-</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        {% endfor %}
                        </tbody>
                    </table>
                {% endfor %}

            </div>
        </div>
    {% endif %}

    {% if object.audittrail and action_list %}
        <h1>{% trans "Changes made via the admin." %}</h1>
    {% endif %}

    {{ block.super }}

{% endblock %}
